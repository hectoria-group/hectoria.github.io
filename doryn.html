<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø¨Ø²Ø§Ø± Ø§Ø¯ØºØ§Ù… Ú©Ù†Ù†Ø¯Ù‡Ù” Ù…Ø®Ø§Ø·Ø¨ÛŒÙ† VCF (Ù‡Ú©ØªÙˆØ±ÛŒØ§)</title>
    <style>
        /* Base & Reset */
        body {
            font-family: 'Tahoma', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f6f9; /* Light background */
            color: #333;
            text-align: right;
            line-height: 1.6;
        }
        .container {
            max-width: 750px;
            margin: 40px auto;
            background-color: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        }
        /* Header & Branding */
        h1 {
            color: #007bff; /* Primary Blue */
            text-align: center;
            margin-bottom: 5px;
        }
        .subtitle {
            text-align: center;
            color: #555;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        hr {
            border: 0;
            height: 1px;
            background: #eee;
            margin: 20px 0;
        }
        /* Steps & Input */
        .step {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #e9f7ff;
            border-radius: 10px;
            border-right: 5px solid #007bff;
        }
        h3 {
            color: #007bff;
            margin-top: 0;
            font-size: 1.4em;
        }
        input[type="file"] {
            display: block;
            padding: 15px;
            border: 2px dashed #007bff;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
            margin-top: 15px;
            cursor: pointer;
            background-color: #fff;
        }
        /* Status and Feedback */
        #status {
            margin-top: 25px;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            display: none; /* Initially hidden */
            transition: all 0.3s ease;
        }
        .status-processing { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .status-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        /* Download Link */
        #downloadLink {
            display: none;
            margin-top: 30px;
            text-align: center;
        }
        #downloadLink a {
            background-color: #28a745; /* Green for success */
            color: white;
            padding: 15px 40px;
            text-decoration: none;
            border-radius: 8px;
            font-size: 1.3em;
            display: inline-block;
            transition: background-color 0.3s;
        }
        #downloadLink a:hover {
            background-color: #1e7e34;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            font-size: 0.9em;
            color: #777;
        }
        .footer p { margin: 5px 0; }
        .footer strong { color: #007bff; }
    </style>
</head>
<body>

<div class="container">
    <h1>Ø§Ø¨Ø²Ø§Ø± Ø§Ø¯ØºØ§Ù… Ú©Ù†Ù†Ø¯Ù‡Ù” VCF</h1>
    <hr>

    <div class="step">
        <h3>Û±. Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ VCF ğŸ“¥</h3>
        <p>Ù„Ø·ÙØ§Ù‹ **Ù‡Ù…Ù‡Ù” ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ VCF. (vCard)** Ø±Ø§ Ú©Ù‡ Ø§Ø² Ø¢ÛŒÙÙˆÙ† Ù…Ù†ØªÙ‚Ù„ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŒ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ù‡Ù…Ø²Ù…Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯. Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„Ø§Ù‹ Ù…Ø­Ù„ÛŒ Ùˆ Ø§ÛŒÙ…Ù† Ø§Ø³Øª.</p>
        <p style="color: #dc3545; font-weight: bold;">(Ù†Ú©ØªÙ‡Ù” Ø­ÛŒØ§ØªÛŒ: Ø¯Ø± Ù¾ÙˆØ´Ù‡ØŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡ØŒ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ `Ctrl+A` ÛŒØ§ `Command+A` Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯.)</p>
        <input type="file" id="vcfFiles" accept=".vcf" multiple>
    </div>
    
    <div id="status" class="status-processing"></div>

    <div id="downloadLink">
        <h3>Û². Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ù†Ù‡Ø§ÛŒÛŒ VCF ğŸš€</h3>
        <a href="#" id="downloadBtn" download="Merged_Contacts_By_Hectoria.vcf">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯</a>
        <p style="margin-top: 10px; color: #007bff;">(ÙØ§ÛŒÙ„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø±Ø§ Ø¨Ù‡ Ú¯ÙˆØ´ÛŒ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯ÛŒ Ø®ÙˆØ¯ Ù…Ù†ØªÙ‚Ù„ Ùˆ Ø¯Ø±ÙˆÙ†â€ŒØ±ÛŒØ²ÛŒ (Import) Ú©Ù†ÛŒØ¯.)</p>
    </div>

</div>

<div class="footer">
    <p>Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù†Ø±Ù… Ø§ÙØ²Ø§Ø±ÛŒ **Ù‡Ú©ØªÙˆØ±ÛŒØ§** Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¢Ø²Ø§Ø¯ Ø§Ø³Ù„Ø§Ù…ÛŒ ÙˆØ§Ø­Ø¯ Ú©Ø§Ø²Ø±ÙˆÙ†</p>
    <p>ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡: **saied rostami**</p>
</div>

<script>
    const fileInput = document.getElementById('vcfFiles');
    const downloadLink = document.getElementById('downloadLink');
    const downloadBtn = document.getElementById('downloadBtn');
    const statusDiv = document.getElementById('status');
    
    fileInput.addEventListener('change', handleFileSelection);

    function setStatus(text, className) {
        statusDiv.textContent = text;
        statusDiv.className = '';
        statusDiv.classList.add(className);
        statusDiv.style.display = 'block';
    }

    function handleFileSelection(event) {
        const files = event.target.files;
        if (files.length === 0) {
            downloadLink.style.display = 'none';
            statusDiv.style.display = 'none';
            return;
        }

        setStatus(`Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ ${files.length} ÙØ§ÛŒÙ„. Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯...`, 'status-processing');
        downloadLink.style.display = 'none';

        let mergedVCFContent = "";
        let filesProcessed = 0;
        const totalFiles = files.length;
        const filePromises = [];

        for (let i = 0; i < totalFiles; i++) {
            const file = files[i];
            const reader = new FileReader();

            const promise = new Promise((resolve, reject) => {
                reader.onload = function(e) {
                    let content = e.target.result;
                    content = content.trim();

                    if (content.toUpperCase().includes("BEGIN:VCARD")) {
                       // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ VCARD Ø¨Ù‡ Ø§Ø³ØªØ±ÛŒÙ†Ú¯ Ù†Ù‡Ø§ÛŒÛŒ
                       mergedVCFContent += content + "\n";
                       filesProcessed++;
                       setStatus(`Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´: ${filesProcessed} Ø§Ø² ${totalFiles} ÙØ§ÛŒÙ„...`, 'status-processing');
                       resolve();
                    } else {
                        // Ø§Ú¯Ø± Ù…Ø­ØªÙˆØ§ Ù…Ø¹ØªØ¨Ø± Ù†Ø¨ÙˆØ¯ØŒ Ø¢Ù† Ø±Ø§ Ø±Ø¯ Ú©Ø±Ø¯Ù‡ Ùˆ Ø¨Ù‡ Ø¨Ø¹Ø¯ÛŒ Ù…ÛŒâ€ŒØ±ÙˆØ¯
                        resolve(); 
                    }
                };
                reader.onerror = reject;
                reader.readAsText(file, 'UTF-8');
            });
            filePromises.push(promise);
        }

        // Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø§ØªÙ…Ø§Ù… Ø®ÙˆØ§Ù†Ø¯Ù† Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
        Promise.all(filePromises).then(() => {
            if (mergedVCFContent.length > 0) {
                createDownloadLink(mergedVCFContent, filesProcessed);
            } else {
                setStatus("âš ï¸ Ù‡ÛŒÚ† Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¯ØºØ§Ù… ÛŒØ§ÙØª Ù†Ø´Ø¯. Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ VCF Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.", 'status-error');
            }
        }).catch(() => {
            setStatus("âŒ Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ø­ÛŒÙ† Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø® Ø¯Ø§Ø¯.", 'status-error');
        });
    }

    function createDownloadLink(finalContent, count) {
        const blob = new Blob([finalContent], { type: 'text/vcard;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        
        downloadBtn.href = url;
        downloadLink.style.display = 'block';
        
        setStatus(`âœ… ${count} Ù…Ø®Ø§Ø·Ø¨ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¯ØºØ§Ù… Ø´Ø¯Ù†Ø¯. Ù„ÛŒÙ†Ú© Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ¹Ø§Ù„ Ø´Ø¯.`, 'status-success');
        
        // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ URL Ù…ÙˆÙ‚Øª Ù¾Ø³ Ø§Ø² Ú©Ù„ÛŒÚ©
        downloadBtn.onclick = function() {
            setTimeout(function() {
                URL.revokeObjectURL(url);
            }, 100);
        };
    }
</script>

</body>
</html>
