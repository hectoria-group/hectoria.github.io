<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>هکتوریا - دستیار هوشمند شما</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />

    <style>
        /* --- متغیرهای اصلی طراحی --- */
        :root {
            --bg-color: #0a0a0a;
            --text-color: #e5e5e5;
            --glass-bg: rgba(25, 25, 25, 0.45);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-blue: #00c6ff;
            --neon-purple: #9256d9;
            --font-family: 'Vazirmatn', sans-serif;
            --error-color: #ff6b6b;
        }

        /* --- استایل‌های کلی و بازنشانی --- */
        * {
            box-sizing: border-box;
            scrollbar-width: thin;
            scrollbar-color: var(--neon-blue) var(--bg-color);
        }
        
        /* استایل اسکرول‌بار سفارشی برای مرورگرهای Webkit */
        *::-webkit-scrollbar { width: 8px; }
        *::-webkit-scrollbar-track { background: #1a1a1a; }
        *::-webkit-scrollbar-thumb {
            background-color: var(--neon-blue);
            border-radius: 10px;
            border: 2px solid #1a1a1a;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            overflow: hidden;
            line-height: 1.8;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- پس زمینه متحرک ذرات --- */
        .background-drops {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden;
        }
        .drop { position: absolute; border-radius: 50%; filter: blur(140px); opacity: 0.3; }
        .d1 { background-color: #89f7fe; width: 350px; height: 350px; top: -10%; left: -5%; animation: move 35s infinite alternate; }
        .d2 { background-color: #d299ff; width: 450px; height: 450px; top: 40%; right: -15%; animation: move 40s infinite alternate-reverse; }
        .d3 { background-color: #ff8c8c; width: 300px; height: 300px; bottom: -12%; left: 20%; animation: move 38s infinite alternate; }
        .d4 { background-color: #fff2a8; width: 400px; height: 400px; bottom: 5%; right: 15%; animation: move 32s infinite alternate-reverse; }
        .d5 { background-color: #ff9a76; width: 250px; height: 250px; top: 10%; right: 40%; animation: move 45s infinite alternate; }
        @keyframes move {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); }
            100% { transform: translate(150px, -120px) scale(1.3) rotate(90deg); }
        }

        /* --- ساختار اصلی و کارت شیشه‌ای --- */
        .container { flex: 1; display: flex; justify-content: center; align-items: center; padding: 2rem 1rem; overflow: hidden; }
        .glass-card {
            width: 100%; max-width: 800px; background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: 20px; backdrop-filter: blur(18px); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
            padding: 2rem; display: flex; flex-direction: column; height: 90vh; max-height: 900px;
        }
        .card-header { text-align: center; margin-bottom: 1.5rem; flex-shrink: 0; }
        .card-header h1 { margin: 0; font-size: 2.2rem; }
        .card-header p { margin: 0.5rem 0 0; color: #a0a0a0; }

        /* --- **تغییر اصلی اینجا است** بخش چت و پیام‌ها --- */
        #chat-container { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
        #chat-box { flex-grow: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
        
        .message { padding: 0.8rem 1.2rem; border-radius: 15px; max-width: 85%; line-break: anywhere; animation: fadeIn 0.5s ease; }
        .user-message { background-color: var(--neon-blue); color: #000; align-self: flex-end; border-bottom-right-radius: 3px; }
        .bot-message { background-color: #2c2c2c; align-self: flex-start; border-bottom-left-radius: 3px; }
        .bot-message b { color: var(--neon-blue); }
        .bot-message a { color: #87CEEB; text-decoration: none; font-weight: bold; }
        .bot-message.error-message { background-color: rgba(255, 107, 107, 0.2); border: 1px solid var(--error-color); }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- **تغییر اصلی اینجا است** بخش ورودی‌ها --- */
        .input-container { margin-top: 1rem; flex-shrink: 0; } /* از رشد و کوچک شدن جلوگیری می‌کند */
        
        #main-input-container { display: flex; gap: 0.5rem; }
        #learning-interface { display: none; /* در ابتدا کاملاً مخفی */ flex-direction: column; gap: 0.5rem; }

        #user-input, .learning-inputs input, .learning-inputs textarea {
            flex-grow: 1; padding: 0.9rem; border: 1px solid var(--glass-border); border-radius: 12px;
            background: rgba(0, 0, 0, 0.4); color: var(--text-color); font-family: var(--font-family); font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        #user-input:focus, .learning-inputs input:focus, .learning-inputs textarea:focus {
            outline: none; border-color: var(--neon-blue); box-shadow: 0 0 10px rgba(0, 198, 255, 0.3);
        }
        
        button {
            padding: 0.9rem 1.7rem; border: none; border-radius: 12px; font-family: var(--font-family); cursor: pointer;
            transition: all 0.3s ease; font-size: 1rem; font-weight: bold;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
        #send-btn, #save-learn-btn { background-color: var(--neon-blue); color: #000; }
        #send-btn:hover, #save-learn-btn:hover { background-color: #00b0e0; }
        #cancel-learn-btn { background-color: #444; color: var(--text-color); }
        #cancel-learn-btn:hover { background-color: #666; }

        .learning-inputs { display: flex; flex-direction: column; gap: 0.5rem; width: 100%; }
        .learning-inputs textarea { min-height: 120px; resize: vertical; }
        .learning-buttons { display: flex; gap: 0.5rem; margin-top: 0.5rem; width: 100%; }
        .learning-buttons button { flex-grow: 1; }

        /* --- فوتر --- */
        footer { text-align: center; padding: 1.5rem; color: #777; }
        .footer-line { height: 1px; background: linear-gradient(90deg, transparent, var(--neon-blue), var(--neon-purple), transparent); margin-bottom: 1rem; }

        /* --- واکنش‌گرایی --- */
        @media (max-width: 768px) {
            .glass-card { height: 95vh; padding: 1.5rem; }
            .card-header h1 { font-size: 1.8rem; }
            button { padding: 0.8rem 1.2rem; }
            .message { max-width: 90%; }
        }
        @media (max-width: 480px) {
             body { overflow: auto; }
            .container { padding: 1rem 0.5rem; }
            .glass-card { height: 98vh; padding: 1rem; border-radius: 15px; }
            .card-header h1 { font-size: 1.6rem; }
            .card-header p { font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div class="background-drops">
        <div class="drop d1"></div><div class="drop d2"></div><div class="drop d3"></div><div class="drop d4"></div><div class="drop d5"></div>
    </div>

    <main class="container">
        <div class="glass-card">
            <div class="card-header">
                <h1>هکتوریا - مصنوعی</h1>
                <p>دستیار هوشمند دانشجویی، توسعه‌یافته در دانشگاه آزاد اسلامی</p>
            </div>
            
            <!-- **تغییر اصلی اینجا است** -->
            <div id="chat-container">
                <div id="chat-box"></div>
                
                <!-- رابط کاربری اصلی چت -->
                <div id="main-input-container" class="input-container">
                    <input type="text" id="user-input" placeholder="سوال خود را بپرسید یا برای آموزش بنویسید 'یاد بگیر'...">
                    <button id="send-btn">ارسال</button>
                </div>

                <!-- رابط کاربری حالت یادگیری -->
                <div id="learning-interface" class="input-container">
                    <div class="learning-inputs">
                        <textarea id="learning-context" placeholder="متن کامل (مثال: پاراگرافی از یک کتاب) را اینجا وارد کنید..."></textarea>
                        <input type="text" id="learning-keyword" placeholder="کلمه کلیدی اصلی این متن (مثال: حسن)">
                    </div>
                    <div class="learning-buttons">
                        <button id="cancel-learn-btn">انصراف</button>
                        <button id="save-learn-btn">ذخیره کن</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- انتخابگرهای عناصر DOM ---
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const mainInputContainer = document.getElementById('main-input-container');
        const learningInterface = document.getElementById('learning-interface');
        const learningContext = document.getElementById('learning-context');
        const learningKeyword = document.getElementById('learning-keyword');
        const saveLearnBtn = document.getElementById('save-learn-btn');
        const cancelLearnBtn = document.getElementById('cancel-learn-btn');

        // --- کلید ذخیره‌سازی محلی ---
        const LOCAL_STORAGE_KEY = 'hectoriaLearnedContext_v2';

        // --- لیست بسیار جامع کلمات اضافی فارسی (Stop Words) ---
        const stopWords = [
            'از','به','با','در','بر','برای','تا','که','و','یا','اما','اگر','چون','را','این','آن','اینجا','آنجا','هر','همه','هیچ','یک','دیگر','نیز','خود','شان',
            'من','تو','او','ما','شما','ایشان','آنها','بود','شد','است','هست','نیست','می‌شود','می‌کند','می‌دهد','دارد','کرد','کنند','کنند','کنند','بودند','رفته',
            'آمده','باشند','باشم','باشی','باشیم','باشید','چه','چرا','کی','کجا','چگونه','کدام','آیا','ولی','پس','فقط','حتی','باید','شاید','یعنی','مثل','مانند',
            'روی','زیر','کنار','بین','بعد','قبل','سپس','همچنین','البته','واقعا','اصلا','معمولا','بسیار','خیلی','کم','زیاد','هرگز','همیشه','گاهی',
            'از','به','با','در','بر','برای','تا','که','و','یا','اما','اگر','چون','را','این','آن','اینجا','آنجا','هر','همه','هیچ','یک','دیگر','نیز','خود','شان',
            'من','تو','او','ما','شما','ایشان','آنها','بود','شد','است','هست','نیست','می‌شود','می‌کند','می‌دهد','دارد','کرد','کنند','کنند','کنند','بودند','رفته',
            'آمده','باشند','باشم','باشی','باشیم','باشید','چه','چرا','کی','کجا','چگونه','کدام','آیا','ولی','پس','فقط','حتی','باید','شاید','یعنی','مثل','مانند',
            'روی','زیر','کنار','بین','بعد','قبل','سپس','همچنین','البته','واقعا','اصلا','معمولا','بسیار','خیلی','کم','زیاد','هرگز','همیشه','گاهی'

        ];

        // --- بارگذاری و ذخیره دانش یادگرفته شده ---
        let learnedContexts = {};
        const loadLearnedData = () => {
            const data = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (data) learnedContexts = JSON.parse(data);
        };
        const saveLearnedData = () => {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(learnedContexts));
        };

        // --- پایگاه دانش اولیه بسیار بزرگ و جامع ---
        const knowledgeBase = {
            "سلام": "سلام! من هکتوریا - مصنوعی هستم، دستیار هوشمند شما. برای آموزش به من، کافیست بنویسید 'یاد بگیر'.",
            "درود": "درود بر شما! آماده پاسخگویی به سوالات دانشجویی شما هستم.",
            "کی هستی": "من هکتوریا - مصنوعی هستم، یک هوش مصنوعی که در دانشگاه آزاد اسلامی برای کمک به دانشجویانی مثل شما توسعه یافته.",
            "اسمت چیه": "نام من هکتوریا - مصنوعی است.",
            "سازنده": "من محصول تلاش و خلاقیت دانشجویان دانشگاه آزاد اسلامی هستم و هدفم ارائه خدمات نوین به جامعه دانشگاهی است.",
            "هدفت چیه": "هدف اصلی من، کمک به شما در مسیر تحصیلی و پاسخ به سوالات شماست. همچنین می‌توانم اطلاعات جدید را از شما یاد بگیرم.",
            "چطور یاد میگیری": "شما می‌توانید با نوشتن کلمه 'یاد بگیر'، یک متن کامل و یک کلمه کلیدی اصلی به من بدهید. من آن متن را ذخیره می‌کنم و اگر در آینده سوالی مرتبط با آن کلمه کلیدی بپرسید، از آن متن برای پاسخ استفاده می‌کنم.",
            "دانشگاه آزاد": "دانشگاه آزاد اسلامی یکی از بزرگترین مجموعه‌های آموزشی در ایران است که در اکثر شهرهای کشور واحد دانشگاهی دارد.",
            "انتخاب واحد": "انتخاب واحد یکی از مهمترین مراحل هر ترم است. حتما چارت درسی و قوانین پیش‌نیاز و هم‌نیاز را از سایت دانشگاه چک کن.",
            "حذف و اضافه": "معمولاً یک یا دو هفته پس از شروع ترم، بازه زمانی حذف و اضافه اعلام می‌شود تا بتوانید دروس خود را ویرایش کنید.",
            "شهریه": "پرداخت شهریه (ثابت و متغیر) پیش‌نیاز اصلی برای انجام انتخاب واحد است. می‌توانید از طریق سامانه آموزشیار اقدام کنید.",
            "وام دانشجویی": "برای دریافت انواع وام‌های تحصیلی، می‌توانید به امور دانشجویی دانشکده خود مراجعه کرده و از شرایط و زمان ثبت‌نام مطلع شوید.",
            "مشروط": "اگر معدل یک ترم شما زیر ۱۲ شود، مشروط محسوب می‌شوید و در ترم بعد سقف مشخصی برای انتخاب واحد خواهید داشت. نگران نباش، قابل جبران است!",
            "معدل": "معدل کل تاثیر زیادی در آینده تحصیلی و شغلی شما دارد. سعی کنید با برنامه‌ریزی، نمرات خوبی کسب کنید.",
            "امتحان": "برای موفقیت در امتحانات، مطالعه در طول ترم، مرور جزوات و حل نمونه سوالات سال‌های قبل بسیار موثر است. موفق باشی!",
            "پایان نامه": "پایان‌نامه در مقاطع ارشد و دکتری، یک کار تحقیقاتی جامع است. انتخاب موضوع مورد علاقه و یک استاد راهنمای خوب، کلید موفقیت شماست.",
            "پروژه": "پروژه‌های درسی فرصت خوبی برای تبدیل دانش تئوری به عملی هستند. سعی کنید در انجام آن‌ها خلاقیت به خرج دهید.",
            "آموزش": "اداره آموزش مسئول تمام امور درسی، انتخاب واحد، نمرات و فارغ‌التحصیلی شماست.",
            "فارغ التحصیلی": "پس از گذراندن تمام واحدهای درسی، باید برای انجام مراحل تسویه حساب به اداره آموزش و مالی مراجعه کنید. تبریک!",
            "خوابگاه": "برای ثبت‌نام و اطلاعات در مورد خوابگاه، به بخش امور دانشجویی و فرهنگی دانشگاه خود مراجعه کنید.",
            "سلف": "برای رزرو غذا معمولاً باید از سامانه تغذیه دانشگاه استفاده کنید. فراموش نکنید که از چند روز قبل غذای خود را رزرو کنید.",
            "کتابخانه": "کتابخانه مرکزی دانشگاه منبع بسیار خوبی برای کتاب‌های درسی و غیردرسی است. با کارت دانشجویی می‌توانید کتاب به امانت بگیرید.",
            "انجمن علمی": "عضویت در انجمن‌های علمی راهی عالی برای شبکه‌سازی، یادگیری بیشتر و برگزاری رویدادهای علمی و تخصصی است.",
            "کامپیوتر": "رشته مهندسی کامپیوتر یکی از پرطرفدارترین رشته‌هاست که آینده شغلی روشنی دارد. این رشته ترکیبی از دانش نرم‌افزار، سخت‌افزار و الگوریتم است.",
            "برنامه نویسی": "برنامه‌نویسی یک مهارت کلیدی در رشته کامپیوتر است. با زبان‌هایی مثل پایتون (Python)، جاوا (Java) و C++ می‌توانید شروع کنید.",
            "پایتون": "پایتون یک زبان برنامه‌نویسی سطح بالا، ساده و بسیار قدرتمند است که در زمینه‌هایی مثل توسعه وب، هوش مصنوعی و تحلیل داده کاربرد فراوان دارد.",
            "هوش مصنوعی": "هوش مصنوعی (AI) شاخه‌ای از علوم کامپیوتر است که به ساخت ماشین‌های هوشمند می‌پردازد. من هم یک نمونه ساده از هوش مصنوعی هستم!",
            "الگوریتم": "الگوریتم یعنی مجموعه‌ای از دستورالعمل‌ها برای حل یک مسئله. درک و طراحی الگوریتم‌ها اساس علوم کامپیوتر است.",
            "ساختمان داده": "ساختمان داده روشی برای ذخیره و سازماندهی اطلاعات در کامپیوتر است تا بتوان به طور موثر از آن‌ها استفاده کرد. مفاهیمی مثل لیست، پشته و صف از این دسته‌اند.",
            "گیت": "گیت (Git) یک سیستم کنترل نسخه است که به برنامه‌نویسان کمک می‌کند تاریخچه تغییرات پروژه‌های خود را مدیریت کرده و به صورت تیمی کار کنند.",
            "گیت هاب": "گیت‌هاب (GitHub) یک پلتفرم میزبانی برای پروژه‌های گیت است که امکانات زیادی برای همکاری و اشتراک‌گذاری کد فراهم می‌کند.",
            "باگ": "باگ به خطا یا اشکال در یک برنامه کامپیوتری گفته می‌شود. فرآیند پیدا کردن و رفع باگ را دیباگینگ می‌نامند.",
            "ممنون": "خواهش می‌کنم! خوشحالم که توانستم مفید باشم. اگر سوال دیگری داشتی، من همیشه اینجا هستم.",
            "مرسی": "خواهش می‌کنم! موفق و پیروز باشی.",
            "تشکر": "وظیفه من کمک به شماست. باعث افتخار است.",
            "خداحافظ": "خدانگهدار! در تمام مراحل تحصیل برای شما آرزوی موفقیت دارم.",
            "بدرود": "بدرود، به امید دیدار مجدد.",            "سلام": "سلام! من هکتوریا - مصنوعی هستم، دستیار هوشمند شما. برای آموزش به من، کافیست بنویسید 'یاد بگیر'.",
            "درود": "درود بر شما! آماده پاسخگویی به سوالات دانشجویی شما هستم.",
            "کی هستی": "من هکتوریا - مصنوعی هستم، یک هوش مصنوعی که در دانشگاه آزاد اسلامی برای کمک به دانشجویانی مثل شما توسعه یافته.",
            "اسمت چیه": "نام من هکتوریا - مصنوعی است.",
            "سازنده": "من محصول تلاش و خلاقیت دانشجویان دانشگاه آزاد اسلامی هستم و هدفم ارائه خدمات نوین به جامعه دانشگاهی است.",
            "هدفت چیه": "هدف اصلی من، کمک به شما در مسیر تحصیلی و پاسخ به سوالات شماست. همچنین می‌توانم اطلاعات جدید را از شما یاد بگیرم.",
            "چطور یاد میگیری": "شما می‌توانید با نوشتن کلمه 'یاد بگیر'، یک متن کامل و یک کلمه کلیدی اصلی به من بدهید. من آن متن را ذخیره می‌کنم و اگر در آینده سوالی مرتبط با آن کلمه کلیدی بپرسید، از آن متن برای پاسخ استفاده می‌کنم.",
            // دسته: امور دانشگاهی و تحصیلی
            "دانشگاه آزاد": "دانشگاه آزاد اسلامی یکی از بزرگترین مجموعه‌های آموزشی در ایران است که در اکثر شهرهای کشور واحد دانشگاهی دارد.",
            "انتخاب واحد": "انتخاب واحد یکی از مهمترین مراحل هر ترم است. حتما چارت درسی و قوانین پیش‌نیاز و هم‌نیاز را از سایت دانشگاه چک کن.",
            "حذف و اضافه": "معمولاً یک یا دو هفته پس از شروع ترم، بازه زمانی حذف و اضافه اعلام می‌شود تا بتوانید دروس خود را ویرایش کنید.",
            "شهریه": "پرداخت شهریه (ثابت و متغیر) پیش‌نیاز اصلی برای انجام انتخاب واحد است. می‌توانید از طریق سامانه آموزشیار اقدام کنید.",
            "وام دانشجویی": "برای دریافت انواع وام‌های تحصیلی، می‌توانید به امور دانشجویی دانشکده خود مراجعه کرده و از شرایط و زمان ثبت‌نام مطلع شوید.",
            "مشروط": "اگر معدل یک ترم شما زیر ۱۲ شود، مشروط محسوب می‌شوید و در ترم بعد سقف مشخصی برای انتخاب واحد خواهید داشت. نگران نباش، قابل جبران است!",
            "معدل": "معدل کل تاثیر زیادی در آینده تحصیلی و شغلی شما دارد. سعی کنید با برنامه‌ریزی، نمرات خوبی کسب کنید.",
            "امتحان": "برای موفقیت در امتحانات، مطالعه در طول ترم، مرور جزوات و حل نمونه سوالات سال‌های قبل بسیار موثر است. موفق باشی!",
            "پایان نامه": "پایان‌نامه در مقاطع ارشد و دکتری، یک کار تحقیقاتی جامع است. انتخاب موضوع مورد علاقه و یک استاد راهنمای خوب، کلید موفقیت شماست.",
            "پروژه": "پروژه‌های درسی فرصت خوبی برای تبدیل دانش تئوری به عملی هستند. سعی کنید در انجام آن‌ها خلاقیت به خرج دهید.",
            "آموزش": "اداره آموزش مسئول تمام امور درسی، انتخاب واحد، نمرات و فارغ‌التحصیلی شماست.",
            "فارغ التحصیلی": "پس از گذراندن تمام واحدهای درسی، باید برای انجام مراحل تسویه حساب به اداره آموزش و مالی مراجعه کنید. تبریک!",
            // دسته: زندگی دانشجویی
            "خوابگاه": "برای ثبت‌نام و اطلاعات در مورد خوابگاه، به بخش امور دانشجویی و فرهنگی دانشگاه خود مراجعه کنید.",
            "سلف": "برای رزرو غذا معمولاً باید از سامانه تغذیه دانشگاه استفاده کنید. فراموش نکنید که از چند روز قبل غذای خود را رزرو کنید.",
            "کتابخانه": "کتابخانه مرکزی دانشگاه منبع بسیار خوبی برای کتاب‌های درسی و غیردرسی است. با کارت دانشجویی می‌توانید کتاب به امانت بگیرید.",
            "انجمن علمی": "عضویت در انجمن‌های علمی راهی عالی برای شبکه‌سازی، یادگیری بیشتر و برگزاری رویدادهای علمی و تخصصی است.",
            // دسته: رشته کامپیوتر و فناوری
            "کامپیوتر": "رشته مهندسی کامپیوتر یکی از پرطرفدارترین رشته‌هاست که آینده شغلی روشنی دارد. این رشته ترکیبی از دانش نرم‌افزار، سخت‌افزار و الگوریتم است.",
            "برنامه نویسی": "برنامه‌نویسی یک مهارت کلیدی در رشته کامپیوتر است. با زبان‌هایی مثل پایتون (Python)، جاوا (Java) و C++ می‌توانید شروع کنید.",
            "پایتون": "پایتون یک زبان برنامه‌نویسی سطح بالا، ساده و بسیار قدرتمند است که در زمینه‌هایی مثل توسعه وب، هوش مصنوعی و تحلیل داده کاربرد فراوان دارد.",
            "هوش مصنوعی": "هوش مصنوعی (AI) شاخه‌ای از علوم کامپیوتر است که به ساخت ماشین‌های هوشمند می‌پردازد. من هم یک نمونه ساده از هوش مصنوعی هستم!",
            "الگوریتم": "الگوریتم یعنی مجموعه‌ای از دستورالعمل‌ها برای حل یک مسئله. درک و طراحی الگوریتم‌ها اساس علوم کامپیوتر است.",
            "ساختمان داده": "ساختمان داده روشی برای ذخیره و سازماندهی اطلاعات در کامپیوتر است تا بتوان به طور موثر از آن‌ها استفاده کرد. مفاهیمی مثل لیست، پشته و صف از این دسته‌اند.",
            "گیت": "گیت (Git) یک سیستم کنترل نسخه است که به برنامه‌نویسان کمک می‌کند تاریخچه تغییرات پروژه‌های خود را مدیریت کرده و به صورت تیمی کار کنند.",
            "گیت هاب": "گیت‌هاب (GitHub) یک پلتفرم میزبانی برای پروژه‌های گیت است که امکانات زیادی برای همکاری و اشتراک‌گذاری کد فراهم می‌کند.",
            "باگ": "باگ به خطا یا اشکال در یک برنامه کامپیوتری گفته می‌شود. فرآیند پیدا کردن و رفع باگ را دیباگینگ می‌نامند.",
            // دسته: تشکر و پایان مکالمه
            "ممنون": "خواهش می‌کنم! خوشحالم که توانستم مفید باشم. اگر سوال دیگری داشتی، من همیشه اینجا هستم.",
            "مرسی": "خواهش می‌کنم! موفق و پیروز باشی.",
            "تشکر": "وظیفه من کمک به شماست. باعث افتخار است.",
            "خداحافظ": "خدانگهدار! در تمام مراحل تحصیل برای شما آرزوی موفقیت دارم.",
            "بدرود": "بدرود، به امید دیدار مجدد."
        };
        
        const addMessage = (message, sender, isError = false) => {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', `${sender}-message`);
            if (isError) messageElement.classList.add('error-message');
            messageElement.innerHTML = message;
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        };

        // --- **تابع جدید و اصلاح شده** برای تغییر حالت ---
        const toggleLearningMode = (enable) => {
            if (enable) {
                mainInputContainer.style.display = 'none';
                learningInterface.style.display = 'flex';
                learningContext.focus();
            } else {
                learningInterface.style.display = 'none';
                mainInputContainer.style.display = 'flex';
                userInput.value = '';
                userInput.focus();
            }
        };

        const cleanText = (text) => {
            let words = text.split(/[\s,،.؟?]+/);
            words = words.filter(word => !stopWords.includes(word.toLowerCase()));
            return words.join(' ');
        };

        const getBotResponse = (userMessage) => {
            const lowerCaseMessage = userMessage.toLowerCase().trim();
            const cleanedQuery = cleanText(lowerCaseMessage);

            for (const mainKeyword in learnedContexts) {
                if (cleanedQuery.includes(mainKeyword)) {
                    const context = learnedContexts[mainKeyword];
                    const sentences = context.match(/[^.!?]+[.!?]+/g) || [context];
                    let relevantSentence = `در متنی که در مورد "<b>${mainKeyword}</b>" به من آموختی، اطلاعات مرتبطی پیدا کردم: <br>"${context}"`;
                    for (const sentence of sentences) {
                        if (sentence.toLowerCase().includes(mainKeyword)) {
                            relevantSentence = `براساس متنی که در مورد "<b>${mainKeyword}</b>" به من آموزش دادی: <br>"${sentence.trim()}"`;
                            break;
                        }
                    }
                    addMessage(relevantSentence, 'bot');
                    return;
                }
            }

            let bestMatch = '';
            for (const keyword in knowledgeBase) {
                if (lowerCaseMessage.includes(keyword)) {
                    if (keyword.length > bestMatch.length) {
                        bestMatch = keyword;
                    }
                }
            }
            if (bestMatch) {
                addMessage(knowledgeBase[bestMatch], 'bot');
                return;
            }

            addMessage("متاسفانه پاسخ دقیقی برای این سوال پیدا نکردم. می‌توانید با استفاده از دستور '<b>یاد بگیر</b>' این موضوع را به من آموزش دهید.", 'bot');
        };

        const handleSendMessage = () => {
            const userMessage = userInput.value.trim();
            if (userMessage) {
                addMessage(userMessage, 'user');
                setTimeout(() => getBotResponse(userMessage), 400);
                userInput.value = '';
            }
        };

        userInput.addEventListener('input', () => {
            const text = userInput.value.trim();
            if (/^یاد\s*بگیر:?$/.test(text) || /^learn:?$/.test(text.toLowerCase())) {
                toggleLearningMode(true);
            }
        });

        sendBtn.addEventListener('click', handleSendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSendMessage();
        });

        saveLearnBtn.addEventListener('click', () => {
            const context = learningContext.value.trim();
            const keyword = learningKeyword.value.trim().toLowerCase();
            if (context && keyword) {
                learnedContexts[keyword] = context;
                saveLearnedData();
                addMessage(`بسیار خب! متن مربوط به "<b>${keyword}</b>" را با موفقیت یاد گرفتم. حالا می‌توانی در موردش از من سوال بپرسی.`, 'bot');
                learningContext.value = '';
                learningKeyword.value = '';
                toggleLearningMode(false);
            } else {
                 addMessage('خطا: لطفاً هر دو فیلد "متن کامل" و "کلمه کلیدی اصلی" را پر کنید.', 'bot', true);
            }
        });

        cancelLearnBtn.addEventListener('click', () => {
            toggleLearningMode(false);
        });

        loadLearnedData();
        setTimeout(() => {
            addMessage("سلام! من هکتوریا هستم، دستیار هوشمند شما. از من سوال بپرسید یا با نوشتن '<b>یاد بگیر</b>' دانش جدیدی به من آموزش دهید.", "bot");
        }, 500);
    });
    </script>
</body>
</html>

