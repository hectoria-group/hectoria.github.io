<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø§Ø²Ù†Ø¯Ù‡ ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª ØªØ¹Ø§Ù…Ù„ÛŒ </title>
    
    <!-- ÙÙˆÙ†Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ (Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ±ØŒ Ø§ÛŒÙ† Ù„ÛŒÙ†Ú© Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ ÙÙˆÙ†Øª Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø®ÙˆØ¯ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* =================================
           Ø¨Ø®Ø´ Û±: Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ Ùˆ Ø¹Ù…ÙˆÙ…ÛŒ
           ================================= */
        :root {
            --bg-color: #12121c;
            --glass-bg: rgba(26, 26, 42, 0.6);
            --border-color: rgba(255, 255, 255, 0.2);
            --primary-color: #0abf53;
            --secondary-color: #7b2cbf;
            --danger-color: #e53935;
            --warning-color: #fdd835;
            --text-color: #e0e0e0;
            --text-muted: #a0a0a0;
            --font-family: 'Vazirmatn', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            direction: rtl;
            text-align: right;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        
        /* Ø§ÙÚ©Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù…ØªØ­Ø±Ú© "Ù†ÙˆØ± Ø¯Ø± Ù…Ù‡" */
        .background-blobs {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.3;
        }
        .blob1 { width: 400px; height: 400px; background: #6a0dad; top: -150px; left: -150px; animation: move 25s infinite alternate; }
        .blob2 { width: 300px; height: 300px; background: #0077b6; bottom: -100px; right: -100px; animation: move 30s infinite alternate-reverse; }
        .blob3 { width: 250px; height: 250px; background: #0abf53; top: 50%; left: 30%; animation: move 20s infinite alternate; }
        
        @keyframes move {
            from { transform: translate(0, 0) scale(1); }
            to { transform: translate(100px, 50px) scale(1.2); }
        }

        /* =================================
           Ø¨Ø®Ø´ Û²: Ø§Ø³ØªØ§ÛŒÙ„ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ
           ================================= */
        
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        button, .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-family: var(--font-family);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        button:hover, .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(10, 191, 83, 0.4);
        }

        .btn-secondary { background-color: var(--secondary-color); }
        .btn-secondary:hover { box-shadow: 0 4px 15px rgba(123, 44, 191, 0.4); }

        .btn-danger { background-color: var(--danger-color); }
        .btn-danger:hover { box-shadow: 0 4px 15px rgba(229, 57, 53, 0.4); }
        
        .btn-small {
            padding: 6px 10px;
            font-size: 14px;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            background-color: rgba(0,0,0,0.2);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-family: var(--font-family);
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(10, 191, 83, 0.3);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* =================================
           Ø¨Ø®Ø´ Û³: Ø³Ø§Ø®ØªØ§Ø± Ùˆ Ù„Ø§ÛŒÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§ØµÙ„ÛŒ
           ================================= */

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }
        
        header {
            text-align: center;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Ø³ØªÙˆÙ† Ú©Ù†Ø§Ø±ÛŒ (Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§) */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sets-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding-left: 10px;
        }
        .sets-list li {
            background-color: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sets-list li.active, .sets-list li:hover {
            background-color: rgba(10, 191, 83, 0.2);
            transform: translateX(-5px);
        }

        .set-item-actions button {
            background: none;
            padding: 5px;
        }
        .set-item-actions button:hover {
             transform: none;
             box-shadow: none;
             color: var(--danger-color);
        }

        /* Ù¾Ù†Ù„ Ø§ØµÙ„ÛŒ Ù…Ø­ØªÙˆØ§ */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ Ù¾Ù†Ù„ Ø§ØµÙ„ÛŒ */
        #cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .card-item {
            background-color: rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 8px;
            position: relative;
        }
        .card-item .front { font-weight: bold; }
        .card-item .back { color: var(--text-muted); font-size: 0.9em; }
        .card-item-actions {
            position: absolute;
            top: 5px;
            left: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .card-item:hover .card-item-actions { opacity: 1; }

        /* Ø­Ø§Ù„Øª Ù…Ø±ÙˆØ± ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª */
        #review-mode {
            text-align: center;
        }

        .flashcard-scene {
            width: 100%;
            max-width: 500px;
            height: 300px;
            perspective: 1000px;
            margin: 2rem auto;
        }
        
        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s;
            cursor: pointer;
        }
        
        .flashcard.is-flipped {
            transform: rotateY(180deg);
        }

        .flashcard-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            padding: 1.5rem;
            border-radius: 16px;
        }
        
        .flashcard-face-front {
            background: linear-gradient(45deg, rgba(123, 44, 191, 0.8), rgba(107, 33, 168, 0.8));
        }

        .flashcard-face-back {
            background: linear-gradient(45deg, rgba(10, 191, 83, 0.8), rgba(8, 148, 65, 0.8));
            transform: rotateY(180deg);
        }
        
        #review-controls, #rating-controls {
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        #rating-controls .btn-rate-again { background-color: var(--danger-color); }
        #rating-controls .btn-rate-again:hover { box-shadow: 0 4px 15px rgba(229, 57, 53, 0.4); }
        #rating-controls .btn-rate-hard { background-color: var(--warning-color); color: #333;}
        #rating-controls .btn-rate-hard:hover { box-shadow: 0 4px 15px rgba(253, 216, 53, 0.4); }
        #rating-controls .btn-rate-easy { background-color: var(--primary-color); }

        /* Ù¾Ø§ÙˆØ±Ù‚ÛŒ (Footer) */
        footer {
            text-align: center;
            padding: 2rem 1rem;
            margin-top: 3rem;
            position: relative;
        }
        /* Ø®Ø· Ù†Ø¦ÙˆÙ†ÛŒ Ù…ØªØ­Ø±Ú© */
        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-color), var(--secondary-color), transparent);
            box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--secondary-color);
            animation: animate-line 5s linear infinite;
        }

        @keyframes animate-line {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        /* Ù‡ÛŒØ¯Ù† Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´â€ŒÙ‡Ø§ */
        .hidden { display: none !important; }

        /* =================================
           Ø¨Ø®Ø´ Û´: ÙˆØ§Ú©Ù†Ø´â€ŒÚ¯Ø±Ø§ÛŒÛŒ (Responsive)
           ================================= */
        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            .sidebar {
                order: 2; /* Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯ */
            }
        }
        
        @media (max-width: 576px) {
            .app-container { padding: 1rem; }
            .glass-panel { padding: 1.5rem; }
            header h1 { font-size: 2rem; }
            .flashcard-scene { height: 250px; }
            .flashcard-face { font-size: 1.2rem; }
            #review-controls, #rating-controls { flex-direction: column; }
        }
    </style>
</head>
<body>
    
    <!-- Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ -->
    <div class="background-blobs">
        <div class="blob blob1"></div>
        <div class="blob blob2"></div>
        <div class="blob blob3"></div>
    </div>

    <header>
        <p>ÙÙ„Ø´ Ú©Ø§Ø±Øª Ø¨Ù‡ Ø±ÙˆØ´ Ø±Ø³ØªÙ…ÛŒ</p>
    </header>

    <main class="app-container">
        <!-- Ø³ØªÙˆÙ† Ú©Ù†Ø§Ø±ÛŒ: Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ -->
        <aside class="sidebar">
            <div class="glass-panel">
                <h2>Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§</h2>
                <ul id="sets-list" class="sets-list">
                    <!-- Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </ul>
                <button id="add-set-btn" style="width: 100%; margin-top: 1rem;">+ Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø¬Ø¯ÛŒØ¯</button>
            </div>
             <div class="glass-panel">
                <h2>Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</h2>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <button id="export-btn" class="btn-secondary">ğŸ“¥ Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
                    <button id="import-btn" class="btn-secondary">ğŸ“¤ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
                    <input type="file" id="import-file-input" class="hidden" accept=".json,.hfc">
                </div>
            </div>
        </aside>

        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
        <div class="main-content">
            
            <!-- Ù†Ù…Ø§ÛŒØ´ Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ ÛŒØ§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ -->
            <div id="set-management-view">
                 <div class="glass-panel" id="welcome-panel">
                    <h2> Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</h2>
                    <p>Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ ÛŒÚ© Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ø³ØªÙˆÙ† Ú©Ù†Ø§Ø±ÛŒ Ø¨Ø³Ø§Ø²ÛŒØ¯ ÛŒØ§ ÛŒÚ©ÛŒ Ø§Ø² Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</p>
                </div>
                <div class="glass-panel hidden" id="card-management-panel">
                    <h2 id="current-set-name"></h2>
                    <p id="current-set-stats"></p>
                    <button id="start-review-btn" style="margin-bottom: 1.5rem;">ğŸš€ Ø´Ø±ÙˆØ¹ Ù…Ø±ÙˆØ±</button>
                    <hr style="border-color: var(--border-color); margin-bottom: 1.5rem;">
                    
                    <h3>Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯</h3>
                    <form id="add-card-form" style="display: flex; flex-direction: column; gap: 1rem;">
                        <textarea id="card-front" placeholder="Ø±ÙˆÛŒ Ú©Ø§Ø±Øª (Ø³ÙˆØ§Ù„)" required></textarea>
                        <textarea id="card-back" placeholder="Ù¾Ø´Øª Ú©Ø§Ø±Øª (Ù¾Ø§Ø³Ø®)" required></textarea>
                        <button type="submit">Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Øª</button>
                    </form>
                    
                    <h3 style="margin-top: 2rem;">Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø¬Ù…ÙˆØ¹Ù‡</h3>
                    <div id="cards-container">
                        <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                    </div>
                </div>
            </div>

            <!-- Ø­Ø§Ù„Øª Ù…Ø±ÙˆØ± -->
            <div id="review-mode" class="glass-panel hidden">
                <div class="flashcard-scene">
                    <div class="flashcard" id="flashcard">
                        <div class="flashcard-face flashcard-face-front" id="review-card-front"></div>
                        <div class="flashcard-face flashcard-face-back" id="review-card-back"></div>
                    </div>
                </div>
                <div id="review-controls">
                    <button id="show-answer-btn">Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®</button>
                </div>
                <div id="rating-controls" class="hidden">
                    <button class="btn-rate-again">Ø¯ÙˆØ¨Ø§Ø±Ù‡ (Û±Ù…)</button>
                    <button class="btn-rate-hard">Ø³Ø®Øª (Û±Û²Ù…)</button>
                    <button class="btn-rate-easy">Ø¢Ø³Ø§Ù† (Û´Ø±)</button>
                </div>
                <p id="review-progress" style="margin-top: 1rem;"></p>
                <button id="back-to-manage-btn" style="margin-top: 1rem;" class="btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            </div>

        </div>
    </main>
    
    <footer>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // =================================
            // Ø¨Ø®Ø´ Û±: ØªØ¹Ø±ÛŒÙ Ù…ØªØºÛŒØ±Ù‡Ø§ Ùˆ Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ DOM
            // =================================
            const STORAGE_KEY = 'hectoria_flashcards_data';
            
            // Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¬Ù…ÙˆØ¹Ù‡
            const addSetBtn = document.getElementById('add-set-btn');
            const setsList = document.getElementById('sets-list');
            const welcomePanel = document.getElementById('welcome-panel');
            const cardManagementPanel = document.getElementById('card-management-panel');
            const currentSetNameEl = document.getElementById('current-set-name');
            const currentSetStatsEl = document.getElementById('current-set-stats');

            // Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Øª
            const addCardForm = document.getElementById('add-card-form');
            const cardFrontInput = document.getElementById('card-front');
            const cardBackInput = document.getElementById('card-back');
            const cardsContainer = document.getElementById('cards-container');
            const startReviewBtn = document.getElementById('start-review-btn');

            // Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø­Ø§Ù„Øª Ù…Ø±ÙˆØ±
            const setManagementView = document.getElementById('set-management-view');
            const reviewModeView = document.getElementById('review-mode');
            const flashcard = document.getElementById('flashcard');
            const reviewCardFront = document.getElementById('review-card-front');
            const reviewCardBack = document.getElementById('review-card-back');
            const showAnswerBtn = document.getElementById('show-answer-btn');
            const ratingControls = document.getElementById('rating-controls');
            const reviewProgress = document.getElementById('review-progress');
            const backToManageBtn = document.getElementById('back-to-manage-btn');
            
            // Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Import/Export
            const exportBtn = document.getElementById('export-btn');
            const importBtn = document.getElementById('import-btn');
            const importFileInput = document.getElementById('import-file-input');

            // state Ø¨Ø±Ù†Ø§Ù…Ù‡: Ø¨Ø±Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            let state = {
                sets: {}, // { setId: { name: '...', cards: { cardId: {...} } } }
                activeSetId: null,
                reviewSession: {
                    isActive: false,
                    dueCards: [],
                    currentCardIndex: 0
                }
            };

            // =================================
            // Ø¨Ø®Ø´ Û²: Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ (LocalStorage)
            // =================================
            function saveData() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            }

            function loadData() {
                const data = localStorage.getItem(STORAGE_KEY);
                if (data) {
                    state = JSON.parse(data);
                }
                // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ¬ÙˆØ¯ Ø³Ø§Ø®ØªØ§Ø±Ù‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ø­ØªÛŒ Ø§Ú¯Ø± Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù„ÙˆØ¯ Ù†Ø´ÙˆØ¯
                state.sets = state.sets || {};
                state.activeSetId = state.activeSetId || null;
                state.reviewSession = state.reviewSession || { isActive: false, dueCards: [], currentCardIndex: 0 };
            }

            // =================================
            // Ø¨Ø®Ø´ Û³: Ø±Ù†Ø¯Ø± Ú©Ø±Ø¯Ù† UI (Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§)
            // =================================

            // Ø±Ù†Ø¯Ø± Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§
            function renderSets() {
                setsList.innerHTML = '';
                Object.keys(state.sets).forEach(setId => {
                    const set = state.sets[setId];
                    const li = document.createElement('li');
                    li.dataset.setId = setId;
                    li.className = state.activeSetId === setId ? 'active' : '';
                    
                    const setNameSpan = document.createElement('span');
                    setNameSpan.textContent = set.name;
                    
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'set-item-actions';
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'ğŸ—‘ï¸';
                    deleteBtn.className = 'btn-small';
                    deleteBtn.onclick = (e) => {
                        e.stopPropagation(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù‡Ù†Ú¯Ø§Ù… Ø­Ø°Ù
                        deleteSet(setId);
                    };
                    
                    actionsDiv.appendChild(deleteBtn);
                    li.appendChild(setNameSpan);
                    li.appendChild(actionsDiv);

                    li.onclick = () => selectSet(setId);
                    setsList.appendChild(li);
                });
            }
            
            // Ø±Ù†Ø¯Ø± Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡ ÙØ¹Ø§Ù„
            function renderCards() {
                if (!state.activeSetId || !state.sets[state.activeSetId]) {
                    welcomePanel.classList.remove('hidden');
                    cardManagementPanel.classList.add('hidden');
                    return;
                }

                welcomePanel.classList.add('hidden');
                cardManagementPanel.classList.remove('hidden');

                const activeSet = state.sets[state.activeSetId];
                currentSetNameEl.textContent = `Ù…Ø¬Ù…ÙˆØ¹Ù‡: ${activeSet.name}`;
                
                const cardCount = Object.keys(activeSet.cards).length;
                const dueCount = getDueCards(state.activeSetId).length;
                currentSetStatsEl.textContent = `${cardCount} Ú©Ø§Ø±Øª Ø¯Ø± Ú©Ù„. ${dueCount} Ú©Ø§Ø±Øª Ø¢Ù…Ø§Ø¯Ù‡ Ù…Ø±ÙˆØ±.`;

                cardsContainer.innerHTML = '';
                Object.keys(activeSet.cards).forEach(cardId => {
                    const card = activeSet.cards[cardId];
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card-item';
                    cardDiv.innerHTML = `
                        <div class="front">${card.front}</div>
                        <div class="back">${card.back}</div>
                        <div class="card-item-actions">
                           <button class="btn-small btn-danger" data-card-id="${cardId}">ğŸ—‘ï¸</button>
                        </div>
                    `;
                    cardsContainer.appendChild(cardDiv);
                });
                
                // Ø§ÙØ²ÙˆØ¯Ù† Event Listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ø­Ø°Ù Ú©Ø§Ø±Øª
                 cardsContainer.querySelectorAll('.btn-danger').forEach(btn => {
                     btn.onclick = () => deleteCard(btn.dataset.cardId);
                 });
            }

            function renderAll() {
                renderSets();
                renderCards();
            }

            // =================================
            // Ø¨Ø®Ø´ Û´: Ù…Ù†Ø·Ù‚ Ø¨Ø±Ù†Ø§Ù…Ù‡ (Ø§ÛŒØ¬Ø§Ø¯ØŒ Ø­Ø°ÙØŒ Ø§Ù†ØªØ®Ø§Ø¨)
            // =================================

            // Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø¬Ø¯ÛŒØ¯
            function createSet() {
                const setName = prompt('Ù†Ø§Ù… Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
                if (setName && setName.trim() !== '') {
                    const setId = 'set_' + Date.now();
                    state.sets[setId] = {
                        name: setName.trim(),
                        cards: {}
                    };
                    selectSet(setId);
                    saveData();
                    renderAll();
                }
            }
            
            function deleteSet(setId) {
                 if (confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ù…Ø¬Ù…ÙˆØ¹Ù‡ "${state.sets[setId].name}" Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`)) {
                    delete state.sets[setId];
                    if (state.activeSetId === setId) {
                        state.activeSetId = null;
                    }
                    saveData();
                    renderAll();
                }
            }

            function selectSet(setId) {
                state.activeSetId = setId;
                // view Ø±Ø§ Ø±ÛŒØ³Øª Ú©Ù†
                setManagementView.classList.remove('hidden');
                reviewModeView.classList.add('hidden');
                state.reviewSession.isActive = false;
                renderAll();
            }

            // Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯
            function addCard(front, back) {
                if (!state.activeSetId) return;

                const cardId = 'card_' + Date.now();
                state.sets[state.activeSetId].cards[cardId] = {
                    front,
                    back,
                    // Ø²Ù…Ø§Ù† Ù…Ø±ÙˆØ± Ø¨Ø¹Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯ØŒ Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù† Ø§Ø³Øª
                    nextReviewDate: Date.now() 
                };
                saveData();
                renderCards(); // ÙÙ‚Ø· Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø±Ù†Ø¯Ø± Ù…Ø¬Ø¯Ø¯ Ú©Ù†
            }
            
            function deleteCard(cardId) {
                if (!state.activeSetId || !state.sets[state.activeSetId].cards[cardId]) return;
                
                if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ú©Ø§Ø±Øª Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
                    delete state.sets[state.activeSetId].cards[cardId];
                    saveData();
                    renderCards();
                }
            }

            // =========================================
            // Ø¨Ø®Ø´ Ûµ: Ù…Ù†Ø·Ù‚ Ù…Ø±ÙˆØ± (Spaced Repetition)
            // =========================================
            
            // Ú¯Ø±ÙØªÙ† Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø²Ù…Ø§Ù† Ù…Ø±ÙˆØ±Ø´Ø§Ù† ÙØ±Ø§ Ø±Ø³ÛŒØ¯Ù‡
            function getDueCards(setId) {
                const set = state.sets[setId];
                if (!set) return [];
                const now = Date.now();
                return Object.keys(set.cards)
                    .map(cardId => ({ id: cardId, ...set.cards[cardId] }))
                    .filter(card => card.nextReviewDate <= now);
            }

            function startReview() {
                if (!state.activeSetId) return;

                const dueCards = getDueCards(state.activeSetId);
                if (dueCards.length === 0) {
                    alert('Ù‡ÛŒÚ† Ú©Ø§Ø±ØªÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø±ÙˆØ± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ø¢ÙØ±ÛŒÙ†!');
                    return;
                }
                
                state.reviewSession = {
                    isActive: true,
                    dueCards: dueCards.sort(() => Math.random() - 0.5), // Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø± Ø¨Ø²Ù†
                    currentCardIndex: 0
                };
                
                setManagementView.classList.add('hidden');
                reviewModeView.classList.remove('hidden');

                showNextReviewCard();
            }

            function showNextReviewCard() {
                if (state.reviewSession.currentCardIndex >= state.reviewSession.dueCards.length) {
                    alert('Ù…Ø±ÙˆØ± Ø§ÛŒÙ† Ø¨Ø®Ø´ ØªÙ…Ø§Ù… Ø´Ø¯!');
                    endReview();
                    return;
                }

                // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† UI
                flashcard.classList.remove('is-flipped');
                ratingControls.classList.add('hidden');
                showAnswerBtn.classList.remove('hidden');

                const card = state.reviewSession.dueCards[state.reviewSession.currentCardIndex];
                reviewCardFront.textContent = card.front;
                reviewCardBack.textContent = card.back;
                
                reviewProgress.textContent = `Ú©Ø§Ø±Øª ${state.reviewSession.currentCardIndex + 1} Ø§Ø² ${state.reviewSession.dueCards.length}`;
            }

            function handleRating(rating) {
                const card = state.reviewSession.dueCards[state.reviewSession.currentCardIndex];
                const now = Date.now();
                
                // ØªØ¹Ø±ÛŒÙ ÙÙˆØ§ØµÙ„ Ø²Ù…Ø§Ù†ÛŒ Ø¨Ù‡ Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡
                const MINUTE = 60 * 1000;
                const DAY = 24 * 60 * MINUTE;

                let nextReviewDate;
                if (rating === 'again') {
                    nextReviewDate = now + 1 * MINUTE;
                } else if (rating === 'hard') {
                    nextReviewDate = now + 12 * MINUTE;
                } else if (rating === 'easy') {
                    nextReviewDate = now + 4 * DAY;
                }
                
                // Ø¢Ù¾Ø¯ÛŒØª Ø²Ù…Ø§Ù† Ù…Ø±ÙˆØ± Ø¯Ø± state Ø§ØµÙ„ÛŒ
                state.sets[state.activeSetId].cards[card.id].nextReviewDate = nextReviewDate;
                saveData();

                // Ø±ÙØªÙ† Ø¨Ù‡ Ú©Ø§Ø±Øª Ø¨Ø¹Ø¯ÛŒ
                state.reviewSession.currentCardIndex++;
                showNextReviewCard();
            }

            function endReview() {
                state.reviewSession.isActive = false;
                setManagementView.classList.remove('hidden');
                reviewModeView.classList.add('hidden');
                renderCards(); // Ø¢Ù¾Ø¯ÛŒØª Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ù…Ø±ÙˆØ±
            }
            
            // =========================================
            // Ø¨Ø®Ø´ Û¶: Ù…Ù†Ø·Ù‚ Import/Export
            // =========================================
            function exportData() {
                const dataStr = JSON.stringify(state, null, 2); // ÙØ±Ù…Øª Ø²ÛŒØ¨Ø§ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ
                const blob = new Blob([dataStr], {type: "application/json"});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                const date = new Date().toISOString().slice(0, 10);
                a.href = url;
                a.download = `hectoria_backup_${date}.hfc`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            function importData(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedState = JSON.parse(e.target.result);
                        // ÛŒÚ© Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø³Ø§Ø¯Ù‡
                        if (importedState && typeof importedState.sets === 'object') {
                             if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø¨Ø§ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø´ÙˆÙ†Ø¯ØŸ')) {
                                state = importedState;
                                saveData();
                                renderAll();
                                alert('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯.');
                            }
                        } else {
                            throw new Error('ÙØ±Ù…Øª ÙØ§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.');
                        }
                    } catch (error) {
                        alert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„: ' + error.message);
                    }
                    // Ø§ÛŒÙ†Ù¾ÙˆØª ÙØ§ÛŒÙ„ Ø±Ø§ Ø±ÛŒØ³Øª Ú©Ù† ØªØ§ Ø§Ù…Ú©Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¬Ø¯Ø¯ Ù‡Ù…Ø§Ù† ÙØ§ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
                    importFileInput.value = ''; 
                };
                reader.readAsText(file);
            }

            // =================================
            // Ø¨Ø®Ø´ Û·: Ø«Ø¨Øª Event Listener Ù‡Ø§
            // =================================
            addSetBtn.addEventListener('click', createSet);
            
            addCardForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const front = cardFrontInput.value.trim();
                const back = cardBackInput.value.trim();
                if (front && back) {
                    addCard(front, back);
                    addCardForm.reset();
                    cardFrontInput.focus();
                }
            });

            startReviewBtn.addEventListener('click', startReview);
            backToManageBtn.addEventListener('click', endReview);

            flashcard.addEventListener('click', () => {
                flashcard.classList.add('is-flipped');
                showAnswerBtn.classList.add('hidden');
                ratingControls.classList.remove('hidden');
            });
            showAnswerBtn.addEventListener('click', () => {
                 flashcard.classList.add('is-flipped');
                 showAnswerBtn.classList.add('hidden');
                 ratingControls.classList.remove('hidden');
            });

            ratingControls.querySelector('.btn-rate-again').addEventListener('click', () => handleRating('again'));
            ratingControls.querySelector('.btn-rate-hard').addEventListener('click', () => handleRating('hard'));
            ratingControls.querySelector('.btn-rate-easy').addEventListener('click', () => handleRating('easy'));
            
            exportBtn.addEventListener('click', exportData);
            importBtn.addEventListener('click', () => importFileInput.click());
            importFileInput.addEventListener('change', importData);

            // =================================
            // Ø¨Ø®Ø´ Û¸: Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ù†Ø§Ù…Ù‡
            // =================================
            loadData();
            renderAll();
        });

    </script>
</body>
</html>
